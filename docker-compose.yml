services:
  server:
    container_name: geoserver-viewer-server
    build:
      context: .
      dockerfile: server/Dockerfile
    environment:
      NODE_ENV: production
      APP_NAME: "${APP_NAME}"
      LOG_LEVEL: "${LOG_LEVEL}"
      SERVER_HOST: 0.0.0.0
      SERVER_PORT: 3000
      CORS_ENABLED: "${CORS_ENABLED}"
      CORS_ALLOWED_ORIGINS: "${CORS_ALLOWED_ORIGINS}"
      BASE_PATH: "${APP_BASE_PATH}"
    expose:
      - "3000"
    networks:
      - geoserver-viewer-network

  client:
    container_name: geoserver-viewer-client
    build:
      context: .
      dockerfile: client/Dockerfile
      args:
        VITE_PROXY_URL: /api/proxy
        VITE_MAP_CENTER: "${VITE_MAP_CENTER}"
        VITE_MAP_ZOOM: "${VITE_MAP_ZOOM:-10}"
        VITE_MAP_MIN_ZOOM: "${VITE_MAP_MIN_ZOOM:-2}"
        VITE_MAP_MAX_ZOOM: "${VITE_MAP_MAX_ZOOM:-22}"
        VITE_MAP_STYLE: "${VITE_MAP_STYLE}"
        VITE_BASE_PATH: "${APP_BASE_PATH}"
    ports:
      - "${APP_PORT:-80}:80"
    environment:
      APP_BASE_PATH: "${APP_BASE_PATH}"
    networks:
      - geoserver-viewer-network

networks:
  geoserver-viewer-network:
    driver: bridge
